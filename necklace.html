<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Hi Jewelry Shopping</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <header>
        <h1>New Arrivals</h1>
        <img src="images/gif1.gif" alt="Loading GIF" class="header-gif">
        <a href="index.html" class="home-button">Home</a>
    </header>

    <main>
        <div class="grid-container" id="product-list"></div>
    </main>

    <script>
        const sheetId = "1_pKpJnNG66rHfO3KnffE85tX-0iHuhN4-pKgn6UT8tw";
        const apiKey = "AIzaSyBwnJTt3tZV61gebywzYb8MIDk4CTcleHQ";
        const sheetName = "Sheet1";
        const url = `https://sheets.googleapis.com/v4/spreadsheets/${sheetId}/values/${sheetName}?key=${apiKey}`;
    
        async function fetchData() {
            try {
                const response = await fetch(url);
                const data = await response.json();
                const rows = data.values.slice(1).reverse(); // Reverse to show latest first
                console.log("Fetched Data:", rows);
    
                const productList = document.getElementById("product-list");
                productList.innerHTML = ""; // Clear previous content
    
                // âœ… Improved category filter: Matches "Necklace" even if written incorrectly
                const filteredRows = rows.filter(row => row[1]?.toLowerCase().includes("necklace"));
    
                filteredRows.forEach(row => {
                    const name = row[1]; // Jewelry Name
                    const price = parseFloat(row[2]); // Original Price
                    const discountedPrice = (price * 0.5).toFixed(2); // 50% Discounted Price
                    const discountPercent = 50;
                    const fullDescription = row[4] || "Beautiful handcrafted jewelry.";
                    let shortDescription = fullDescription.length > 50 ? fullDescription.substring(0, 50) + "..." : fullDescription;
    
                    // âœ… Convert all Google Drive image links correctly
                    const imageUrls = row[3]
                        ? row[3].split(/,\s*/).map(link =>
                            link.replace("https://drive.google.com/open?id=", "https://lh3.googleusercontent.com/d/")
                        )
                        : [];
    
                    function redirectToProductPage() {
                        const queryString = `product.html?name=${encodeURIComponent(name)}&price=${encodeURIComponent(discountedPrice)}&description=${encodeURIComponent(fullDescription)}&images=${encodeURIComponent(imageUrls.join(","))}`;
                        window.location.href = queryString;
                    }
    
                    const productItem = document.createElement("div");
                    productItem.classList.add("product-item");
                    productItem.style.cursor = "pointer";
                    productItem.onclick = redirectToProductPage;
    
                    const imgContainer = document.createElement("div");
                    imgContainer.classList.add("image-slider");
    
                    const img = document.createElement("img");
                    let currentIndex = 0;
    
                    if (imageUrls.length > 0) {
                        img.src = imageUrls[currentIndex];
                        img.alt = name;
                        imgContainer.appendChild(img);
                    } else {
                        img.src = "images/placeholder.jpg"; // âœ… Default image if no image available
                        img.alt = "No Image Available";
                        imgContainer.appendChild(img);
                    }
    
                    imgContainer.onclick = redirectToProductPage;
    
                    // âœ… Proper image slider implementation
                    if (imageUrls.length > 1) {
                        setInterval(() => {
                            currentIndex = (currentIndex + 1) % imageUrls.length;
                            img.src = imageUrls[currentIndex];
                        }, 2000);
                    }
    
                    const productDetails = document.createElement("div");
                    productDetails.classList.add("product-details");
    
                    const title = document.createElement("h3");
                    title.textContent = name;
    
                    const priceSection = document.createElement("div");
                    priceSection.classList.add("price-section");
    
                    const priceInfo = document.createElement("p");
                    priceInfo.classList.add("price-info");
                    priceInfo.innerHTML = `<span class="discount-text">â†“${discountPercent}%</span> <del>â‚¹${price}</del> <strong>â‚¹${discountedPrice}</strong>`;
    
                    const detailsPara = document.createElement("p");
                    detailsPara.classList.add("product-details-text");
                    detailsPara.innerText = shortDescription;
    
                    const hotDeal = document.createElement("p");
                    hotDeal.classList.add("hot-deal");
                    hotDeal.textContent = "ðŸ”¥Hot Deal";
    
                    const shareBtn = document.createElement("button");
                    shareBtn.textContent = "Share";
                    shareBtn.onclick = (event) => {
                        event.stopPropagation();
                        const currentPageLink = window.location.href;
                        const message = `ðŸ”¥ -50% OFF | 6 months warranty \n Check this out: ${name} \nOriginal Price: â‚¹${price} \nDiscounted Price: â‚¹${discountedPrice} \n${imageUrls[0]} \n \nView more: ${currentPageLink}`;
                        const whatsappUrl = `http://wa.me/+917795383476?text=${encodeURIComponent(message)}`;
                        window.open(whatsappUrl, "_blank");
                    };
    
                    priceSection.appendChild(priceInfo);
                    productDetails.appendChild(title);
                    productDetails.appendChild(priceSection);
                    productDetails.appendChild(detailsPara);
                    productDetails.appendChild(hotDeal);
                    productDetails.appendChild(shareBtn);
    
                    productItem.appendChild(imgContainer);
                    productItem.appendChild(productDetails);
                    productList.appendChild(productItem);
                });
    
                if (filteredRows.length === 0) {
                    productList.innerHTML = "<p>No Necklaces available.</p>";
                }
            } catch (error) {
                console.error("Error fetching data:", error);
            }
        }
    
        fetchData();
    </script>
    
</body>
</html>
